# デコレータとは？
* デコレータとは、関数やメソッドに動作を追加するための特殊な種類の関数であり、既存のコードを変更せずに関数の動作を修正できる強力なツール。

## デコレーション：装飾する
- ある関数Aがある
- Aに***ある処理Deco***を追加して使いたい
- 処理Decoをデコレータと呼ぶ

- 時間計測するデコレータを作って、「関数の処理時間を出す」とかが分かりやすい
![alt text](image/13.デコレータ/image.png)
https://www.youtube.com/@pythonvtuber9917

## 書き方
### パターン化された実装方法

```python
def print_info(func):
    def wrapper(*args, **kwargs):
        print("追加でデコレーションしたい内容 A")
        result = func(*args, **kwargs)
        print("追加でデコレーションしたい内容 B")
        return result
    return wrapper
```

### `@wraps`をつけて、デコレータであることを明記するのが一般
- `@wraps`はデコレータ内部で元の関数の情報（名前、ドキュメンテーション等）を保持するような裏の処理

    ```python
    from functools import wraps

    def print_info(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            print("追加でデコレーションしたい内容 A")

            result = func(*args, **kwargs)
            print(result)

            print("追加でデコレーションしたい内容 B")
            return result
        return wrapper
    ```



## 使い方

関数を定義する際に`@デコレータ名`をつけいる

```python
@print_info
def add_num(a, b):
    return a + b

r = add_num(10, 20)

# 出力--------------
# 追加でデコレーションしたい内容 A
# 30
# 追加でデコレーションしたい内容 B
```


## よくある事例
### 関数の処理時間を計測するデコレータ


```python
import time
from functools import wraps
from typing import Any, Callable

def timer_decorator(func: Callable) -> Callable:
    """
    関数の処理時間を計測するデコレータ

    Args:
        func: Callable
            処理時間を計測したい関数

    Returns:
        Callable:
            デコレータが適用された関数
    """
    @wraps(func)
    def wrapper(*args: Any, **kwargs: Any) -> Any:
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        elapsed_time = end_time - start_time
        print(f"{func.__name__} took {elapsed_time:.6f} seconds")
        return result
    return wrapper

@timer_decorator
def example_function(duration: float) -> None:
    """
    一定時間停止するサンプル関数

    Args:
        duration: float
            停止する秒数
    """
    time.sleep(duration)

if __name__ == '__main__':
    example_function(2)

# 出力---------


```


## 複数のデコレータで関数を包む

- 関数は複数のデコレータによって装飾されることがある。
- その場合、デコレータは上から下へと適用される。
    - つまり、一番上のデコレータが最初に、一番下のデコレータが最後に適用されることになる
```python
def print_more(func):
    def wrapper(*args, **kwargs):
        print('追加でデコレーションしたい内容 3')
        result = func(*args, **kwargs)
        print('追加でデコレーションしたい内容 4')
        return result

    # クロージャーでreturn
    return wrapper


def print_info(func):
    def wrapper(*args, **kwargs):
        print("追加でデコレーションしたい内容 1")
        result = func(*args, **kwargs)
        print("追加でデコレーションしたい内容 2")
        return result

    # クロージャーでreturn
    return wrapper


@print_info
@print_more
def add_num(a, b):
    return a + b


r = add_num(10, 20)
print(r)
```

順番注意
```
追加でデコレーションしたい内容 1
追加でデコレーションしたい内容 3
追加でデコレーションしたい内容 4
追加でデコレーションしたい内容 2
30
```

### @print_infoと@print_moreを入れ替える

```python
@print_more
@print_info
def add_num(a, b):
    return a + b


r = add_num(10, 20)
print(r)
```
順番注意
```
追加でデコレーションしたい内容 3
追加でデコレーションしたい内容 1
追加でデコレーションしたい内容 2
追加でデコレーションしたい内容 4
30
```