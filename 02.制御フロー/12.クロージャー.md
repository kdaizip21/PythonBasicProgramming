# クロージャー ～初心者向け解説～

クロージャーはPythonで強力かつ便利な機能ですが、初心者にとっては難解に感じられることが多いです。このドキュメントでは、クロージャーの基本的な概念と使用例をわかりやすく解説します。

---

## クロージャーとは？

クロージャーは、「関数」と「その関数が作られた環境（スコープ）」をセットで保持する仕組みです。この仕組みにより、関数の外で定義された変数（ローカルでもグローバルでもない変数）を関数が「記憶」して使用することが可能になります。

簡単に言うと、**「関数が必要なデータを覚えていて、後からそのデータを使える状態」**を作り出す仕組みです。

---

## 基本例：普通の関数とクロージャーの違い

### 1. 普通の関数

以下は、内側の関数（インナー関数）を持つ普通の関数の例です。

```python
def outer(a, b):
    def inner():
        return a + b
    return inner()

# 実行
print(outer(2, 3))  # 出力: 5
```

この関数は、`outer` を呼び出した際にインナー関数 `inner` を実行し、結果を返します。

### 2. クロージャー

以下のように書き換えると、クロージャーになります。

```python
def outer(a, b):
    def inner():
        return a + b
    return inner  # inner を実行せずに「関数オブジェクト」として返す

# 実行
result = outer(2, 3)
print(result)  # 出力: <function outer.<locals>.inner at 0x...>

# 関数を呼び出す
print(result())  # 出力: 5
```

#### ポイント：
1. `outer` 関数は `inner` を実行せずに関数オブジェクトとして返します。
2. `inner` 関数は、`outer` 関数が終了した後も `a` と `b` の値を記憶しています。
3. 必要なタイミングで `result()` を呼び出すことで初めて計算が実行されます。

---

## クロージャーの具体例

### 1. 円の面積を求める関数

クロージャーを使って、特定の値（ここでは π）を「覚えた」関数を作ることができます。

```python
# アウター関数で π を設定

def circle_area_func(pi):
    def circle_area(radius):
        return pi * radius * radius
    return circle_area

# クロージャーの作成
area1 = circle_area_func(3.14)
area2 = circle_area_func(3)

# 半径 10 の場合の計算
print(area1(10))  # 出力: 314.0
print(area2(10))  # 出力: 300
```

#### ポイント：
- `area1` は π = 3.14 を覚えた関数。
- `area2` は π = 3 を覚えた関数。
- これにより、異なる条件に応じた関数を柔軟に作成できます。

---

### 2. 底辺と高さの計算

```python
# アウター関数で固定値を設定

def area_cal_func(base):
    def area_cal(height):
        return base * height
    return area_cal

# クロージャーの作成
area1 = area_cal_func(25)
area2 = area_cal_func(35)

# 高さを変えて計算
print(area1(10))  # 出力: 250
print(area2(10))  # 出力: 350
```

#### ポイント：
- `base` を固定値として記憶させ、動的に高さを変更して計算可能にしています。

---

## クロージャーのメリット

1. **データのカプセル化**
   - クロージャーは、外部に公開する必要のない変数を関数内に隠し持つことができます。

2. **柔軟な関数作成**
   - 異なる条件に応じたカスタマイズ可能な関数を簡単に生成できます。

3. **グローバル変数の回避**
   - グローバル変数を使わずに、データを関数に保持させることができます。

---

## 注意点

1. **メモリ使用量**
   - クロージャーは、キャプチャした変数を保持するため、不要になった場合は適切に破棄する必要があります。

2. **過度な使用の回避**
   - クロージャーを多用するとコードの可読性が下がる可能性があります。

---

## まとめ

- クロージャーは、「関数が必要なデータを覚えておく」仕組みを提供します。
- データのカプセル化や柔軟な関数作成に適しており、グローバル変数の回避にも役立ちます。
- 適切に活用することで、効率的で読みやすいコードを実現できます。

これらを活用して、Pythonのプログラミングスキルを一段上のレベルに引き上げましょう！

