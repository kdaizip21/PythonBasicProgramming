# _（アンダースコア）の使い所

## はじめに

Pythonではアンダースコア（`_`）を活用することで、コードの可読性や意図を明確にすることができます。この資料では、アンダースコアの主要な使い方について解説します。基本的にアンダースコアの有無は動作に影響しませんが、一部の特殊なケースでは異なる挙動を示します。

---

## 1. 値を無視する

アンダースコアは、変数を明示的に「無視する」ことを示すために使用されます。

### 読み込まない変数

タプルの要素の一部を無視する場合:

```python
# 2番目の値を利用しないことを明記
x, _, z = (1, 2, 3)
```

### ループのインデックスを使用しない場合

```python
for _ in range(10):
    print('hello')
```

### 返り値の一部を無視する

複数の返り値を持つ関数で一部の値を無視する:

```python
# 2つの返り値を持つ関数
def func_return_2():
    return "A", "B"

# 2つ目の返り値を無視
x, _ = func_return_2()
```

---

## 2. 関数や変数の命名で使い方を区別する

アンダースコアの付け方によって、変数や関数の用途やスコープを明確に示すことができます。以下はPEP8に従った使い方です。

### 2-1. 関数の前にアンダースコア1つ `_function(x)`

内部利用を意図した関数や変数に使用します。

```python
def _internal_function(x):
    return x * 2

# この関数はfrom module import * でインポートされません
```

> **補足:** クラス内の関数では、`self._private_variable`のようにアクセス可能です。

### 2-2. 関数の後にアンダースコア1つ `function_(x)`

Pythonの予約語と名前が被る場合に使用します。

```python
# list という予約語を避けるため
list_ = [1, 2, 3]
```

### 2-3. 関数の前にアンダースコア2つ `__function(x)`

名前修飾（Name Mangling）を行い、外部からアクセスできないようにします。

```python
class MyClass:
    def __private_method(self):
        print("This is a private method")

# 外部からはアクセス不可
obj = MyClass()
# obj.__private_method()  # エラー
```

### 2-4. 関数の前後にアンダースコア2つずつ `__function__(x)`

Pythonで特別な意味を持つマジックメソッド（ダンダーメソッド）に使用されます。

```python
class Example:
    def __init__(self, value):
        self.value = value

obj = Example(10)
print(obj.__dict__)  # {'value': 10}
```

> **注意:** 自分で新しい`__magic_method__`を定義することは推奨されません。

---

## 3. 数字を読みやすくする

アンダースコアを使用して数字を3桁区切りで表記できます。これは、カンマ区切りと同様の目的で使用されます。

```python
x = 100_000_000
print(x)  # 100000000
```

---

## 4. インタプリタで最後に表示された値を代表する

インタプリタ（REPL）でアンダースコアは最後に評価された値を表します。

```python
>>> 1
1
>>> _ * 3  # _ は直前の値（1）を示す
3
>>> _ * 10  # _ は直前の値（3）を示す
30
```

---

## 5. 最新Pythonの補足例

### パターンマッチングでのアンダースコア
Python 3.10以降で導入された`match`文では、アンダースコアをワイルドカードとして使用します。

```python
match command:
    case "start":
        print("Starting")
    case _:  # すべてのその他のケース
        print("Unknown command")
```

---

## 終わりに

アンダースコアは、Pythonコードの可読性や意図を明確にするために強力なツールです。PEP8に従い、適切に活用することで、より保守性の高いコードを書くことができます。

