
# éåŒæœŸå‡¦ç†ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯éåŒæœŸå‡¦ç†ã®ä¸€ä¾‹ã‚’ç¤ºã™Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€å¯¿å¸è·äººãŒå¯¿å¸ã¨å‘³å™Œæ±ã‚’ä½œã‚Šã€å®¢ãŒãã‚Œã‚’å¾…ã¤ã¨ã„ã†çŠ¶æ³ã‚’æ¨¡æ“¬ã—ã¦ã„ã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜

1. `print_with_time(str: str) -> None`: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ã‘ã¦å‡ºåŠ›ã™ã‚‹é–¢æ•°ã§ã™ã€‚å¼•æ•°ã«ã¯å‡ºåŠ›ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¾ã™ã€‚

2. `async def cook_sushi(sushi_cook_time: int) -> str`: å¯¿å¸ã‚’ä½œã‚‹é–¢æ•°ã§ã™ã€‚æŒ‡å®šã—ãŸç§’æ•°ï¼ˆ`sushi_cook_time`ï¼‰å¾…ã£ãŸå¾Œã«ã€'sushi'ã¨ã„ã†æ–‡å­—åˆ—ã‚’è¿”ã—ã¾ã™ã€‚

3. `async def cook_miso() -> str`: å‘³å™Œæ±ã‚’ä½œã‚‹é–¢æ•°ã§ã™ã€‚ã“ã®é–¢æ•°ã¯1ç§’å¾…ã£ãŸå¾Œã«ã€'miso'ã¨ã„ã†æ–‡å­—åˆ—ã‚’è¿”ã—ã¾ã™ã€‚

4. `def eat(dish: str) -> None`: æ–™ç†ã‚’é£Ÿã¹ã‚‹é–¢æ•°ã§ã™ã€‚å¼•æ•°ã«ã¯é£Ÿã¹ã‚‹æ–™ç†ã®åå‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚

5. `async def order_and_wait_till_done() -> None`: å¯¿å¸ã¨å‘³å™Œæ±ã‚’æ³¨æ–‡ã—ã¦å¾…ã¡ã€å‡ºæ¥ä¸ŠãŒã£ãŸé †ã«é£Ÿã¹ã‚‹é–¢æ•°ã§ã™ã€‚

6. `async def order_and_leave_if_not_done() -> None`: å¯¿å¸ã‚’æ³¨æ–‡ã—ã¦ã‹ã‚‰5ç§’çµŒã£ã¦ã‚‚æ¥ãªã„å ´åˆã€åº—ã‚’å‡ºã‚‹é–¢æ•°ã§ã™ã€‚

7. `async def order_and_order_else_if_not_done() -> None`: å¯¿å¸ã‚’æ³¨æ–‡ã—ã¦ã‹ã‚‰5ç§’çµŒã£ã¦ã‚‚æ¥ãªã„å ´åˆã€å‘³å™Œæ±ã‚’æ³¨æ–‡ã™ã‚‹é–¢æ•°ã§ã™ã€‚

## ã‚³ãƒ¼ãƒ‰

```python
import asyncio
import datetime
import sys

def print_with_time(str: str) -> None:
    """
    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ã‘ã¦å‡ºåŠ›ã™ã‚‹é–¢æ•°
    
    Args:
    str (str): å‡ºåŠ›ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    """
    print(f"{datetime.datetime.now().strftime('%H:%M:%S')} {str}")

async def cook_sushi(sushi_cook_time: int) -> str:
    """
    å¯¿å¸ã‚’ä½œã‚‹é–¢æ•°ã€‚sushi_cook_timeç§’å¾Œã«'sushi'ã‚’è¿”ã™
    
    Args:
    sushi_cook_time (int): å¯¿å¸ã‚’ä½œã‚‹ã®ã«ã‹ã‹ã‚‹æ™‚é–“ï¼ˆç§’ï¼‰

    Returns:
    str: 'sushi'
    """
    print_with_time('sushiè·äººã€Œsushiå…¥ã‚Šã¾ã—ãŸï¼ã€')
    await asyncio.sleep(sushi_cook_time)
    print_with_time('sushiè·äººã€ŒsushiãŠå¾…ã¡ï¼ã€')
    return 'sushi'

async def cook_miso() -> str:
    """
    å‘³å™Œæ±ã‚’ä½œã‚‹é–¢æ•°ã€‚1ç§’å¾Œã«'miso'ã‚’è¿”ã™

    Returns:
    str: 'miso'
    """
    print_with_time('sushiè·äººã€Œmisoå…¥ã‚Šã¾ã—ãŸï¼ã€')
    await asyncio.sleep(1)
    print_with_time('sushiè·äººã€ŒmisoãŠå¾…ã¡ï¼ã€')
    return 'miso'

def eat(dish: str) -> None:
    """
    æ–™ç†ã‚’é£Ÿã¹ã‚‹é–¢æ•°ã€‚é£Ÿã¹ã‚‹æ–™ç†ã®åå‰ã‚’å¼•æ•°ã«ã¨ã‚‹ã€‚

    Args:
    dish (str): æ–™ç†ã®åå‰
    """
    print_with_time(f"å®¢ã€Œ{dish}ã†ã¾ã‚ğŸ˜‹ã€")

async def order_and_wait_till_done() -> None:
    """
    å¯¿å¸ã¨å‘³å™Œæ±ã‚’é ¼ã‚“ã§ãŠã¨ãªã—ãå¾…ã¡ã€å‡ºæ¥ä¸ŠãŒã£ãŸé †ã«é£Ÿã¹ã‚‹é–¢æ•°
    """
    for future in asyncio.as_completed([cook_sushi(sushi_cook_time), cook_miso()]):
        result = await future
        eat(result)

async def order_and_leave_if_not_done() -> None:
    """
    å¯¿å¸ã‚’é ¼ã‚“ã§ã‹ã‚‰5ç§’ã‹ã‹ã£ã¦ã‚‚æ¥ãªã‹ã£ãŸã‚‰åº—ã‚’å‡ºã‚‹é–¢æ•°
    """
    try:
        result = await asyncio.wait_for(cook_sushi(sushi_cook_time), timeout=5.0)
        eat(result)
    except asyncio.TimeoutError:
        print_with_time('å®¢ã€ŒsushiãŒæ¥ãªã„ãªã‚‰å¸°ã‚‰ã›ã¦é ‚ãã€')

async def order_and_order_else_if_not_done() -> None:
    """
    å¯¿å¸ã‚’é ¼ã‚“ã§ã‹ã‚‰5ç§’ã‹ã‹ã£ã¦ã‚‚æ¥ãªã‹ã£ãŸã‚‰å‘³å™Œæ±ã‚’é ¼ã‚€é–¢æ•°
    """
    for future in asyncio.as_completed([cook_sushi(sushi_cook_time), asyncio.sleep(5)]):
        result = await future
        if result == 'sushi':
            eat(result)
            break
        else:
            # sushi ãŒæ¥ãªã‹ã£ãŸå ´åˆ (asyncio.sleep(5)ã®æˆ»ã‚Šå€¤ã¯ None)
            result = await cook_miso()
            eat(result)

if __name__ == '__main__':
    sushi_cook_time = 7

    print(order_and_wait_till_done.__doc__)
    asyncio.run(order_and_wait_till_done())
    print('')

    print(order_and_leave_if_not_done.__doc__)
    asyncio.run(order_and_leave_if_not_done())
    print('')

    print(order_and_order_else_if_not_done.__doc__)
    asyncio.run(order_and_order_else_if_not_done())
```